import{_ as q,a as E,r as k,w as f,x as V,y as n,u as o,L as w,C as y,B as p,A as g,M as R,v as B,c as O,z as C,$ as b,N as x,D as h,K,O as z,P as j}from"./index-60f7ff30.js";import{d as A,u as T,b as M,c as G,e as J,f as Q}from"./VMenu-ec599dc0.js";import{V as W,s as $,t as X,r as H,q as U,D as L}from"./VCard-ba4fbd38.js";import{V as F,a as Y,L as Z}from"./LoadingIndicator-b03dcd89.js";import{V as P}from"./VContainer-f69f8121.js";import"./VTextField-bcce73b8.js";const ee={class:"seasonToggleContainer"},se={__name:"ShowHero",props:["showData"],emits:["seasonSelected"],setup(v,{emit:t}){const c=v;let _=E(["All Seasons"]);c.showData.seasons.map(S=>(_.push(`Season ${S.season}`),_));let r=k("");const D=S=>{let d=null;S!==!0&&(d=r.value,t("seasonSelected",d))};return(S,d)=>(f(),V(H,{class:"mx-auto","max-width":"500"},{default:n(()=>[o(W,{src:c.showData.image,height:"400",cover:""},null,8,["src"]),o($,null,{default:n(()=>[w(y(c.showData.title)+" ",1),o(F,null,{default:n(()=>[w(y(c.showData.seasons.length)+" SEASONS ",1)]),_:1})]),_:1}),p("div",null,[o(A),o(X,null,{default:n(()=>[w(y(c.showData.description),1)]),_:1})]),p("div",ee,[o(Y,{"onUpdate:menu":D,modelValue:g(r),"onUpdate:modelValue":d[0]||(d[0]=i=>R(r)?r.value=i:r=i),label:"Select Season",items:g(_)},null,8,["modelValue","items"])])]),_:1}))}},te=q(se,[["__scopeId","data-v-46ce3f02"]]);const ae={class:"seasonInfo"},oe=["src"],ie={class:"episode"},le={class:"buttonArea"},ne={class:"textArea"},re={class:"textHeader"},de={class:"textBody"},ce={__name:"ShowEpisodesList",props:["showData","seasonFilter"],setup(v){const t=v;let c=k(0),_=k(1);const{currentlyPlaying:r}=B(T()),D=async(i,e)=>{try{const s=await h.auth.getSession(),{data:l}=await h.from("favorites").select("is_favorite, time_played").eq("user_email",s.data.session.user.email).eq("showId",t.showData.id).eq("season",i.season).eq("episode",e.episode);if(l.length>0)await h.from("favorites").update({is_favorite:!e.isFavorite,date_added:new Date}).eq("user_email",s.data.session.user.email).eq("showId",t.showData.id).eq("season",i.season).eq("episode",e.episode);else{const m=await h.auth.getSession();await h.from("favorites").insert({user_email:m.data.session.user.email,showId:t.showData.id,show_name:t.showData.title,season:i.season,date_added:new Date,last_updated:t.showData.updated,episode:e.episode,episode_title:e.title,episode_description:e.description,season_image:i.image,file:e.file,is_favorite:!0,time_played:e.timePlayed||0})}e.isFavorite=!e.isFavorite,c.value++,_.value++}catch(s){console.error("Error toggling favorite:",s)}},S=async(i,e)=>{try{const s=await h.auth.getSession();let l=0,{data:m}=await h.from("favorites").select("id, time_played").eq("user_email",s.data.session.user.email).eq("showId",t.showData.id).eq("season",i.season).eq("episode",e.episode);m.length>0?l=m[0].time_played:await h.from("favorites").insert({user_email:s.data.session.user.email,showId:t.showData.id,show_name:t.showData.title,season:i.season,date_added:e.dateAdded||null,last_updated:t.showData.updated,episode:e.episode,episode_title:e.title,episode_description:e.description,season_image:i.image,file:e.file,is_favorite:e.isFavorite||!1,time_played:0}),r.value.showId=t.showData.id,r.value.showTitle=t.showData.title,r.value.episodeTitle=e.title,r.value.episode=e.episode,r.value.season=i.season,r.value.file=e.file,r.value.timePlayed=l}catch(s){console.error("Error adding listening history / loading currently playing:",s)}},d=O(()=>{if(t.seasonFilter==="All Seasons"||t.seasonFilter==="")return t.showData.seasons;{const i=parseInt(t.seasonFilter.split(" ")[1]);return t.showData.seasons.filter(s=>s.season===i)}});return(i,e)=>(f(!0),C(x,null,b(d.value,s=>(f(),V(H,{width:"100%",class:"seasonContainer",key:s.season},{default:n(()=>[p("div",ae,[p("img",{src:s.image,height:"100"},null,8,oe),o($,null,{default:n(()=>[w("Season "+y(s.season),1)]),_:2},1024),o(F,null,{default:n(()=>[w(y(s.episodes.length)+" EPISODES",1)]),_:2},1024)]),o(M,{"max-width":""},{default:n(()=>[(f(!0),C(x,null,b(s.episodes,l=>(f(),V(G,{key:l.episode},{default:n(()=>[p("div",ie,[p("div",le,[o(U,{icon:"mdi-play",size:"large",color:"purple",variant:"outlined",onClick:m=>S(s,l),"data-episode":[l.episode],"data-season":[s.season]},null,8,["onClick","data-episode","data-season"])]),p("div",ne,[p("div",re,[o(J,null,{default:n(()=>[l.isFavorite?(f(),V(L,{class:"heart",onClick:m=>D(s,l),icon:"mdi-heart",key:g(c)},null,8,["onClick"])):(f(),V(L,{class:"heart",onClick:m=>D(s,l),icon:"mdi-heart-outline",key:g(_)},null,8,["onClick"])),w(" "+y(l.title)+" ",1),o(F,{class:"episodeChip"},{default:n(()=>[w("EPISODE "+y(l.episode),1)]),_:2},1024)]),_:2},1024)]),p("div",de,[o(Q,null,{default:n(()=>[w(y(l.description),1)]),_:2},1024)])])]),o(A)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))}},ue=q(ce,[["__scopeId","data-v-05162b1a"]]);const _e=v=>(z("data-v-3887d759"),v=v(),j(),v),he=_e(()=>p("div",{class:"bottomSpacer"},null,-1)),pe={__name:"ShowView",setup(v){let t=k(!1);const{currentShowId:c}=B(T());let _=E({});(async()=>{try{if(c.value){const d=`https://podcast-api.netlify.app/id/${c.value}`;let e=await(await fetch(d)).json();const s=[];for(const u of e.seasons)for(const a of u.episodes)s.push({file:a.file,showId:c.value,season:u.season,episode:a.episode,title:a.title,description:a.description});const l=await h.auth.getSession(),m=s.map(({showId:u,season:a,episode:I})=>h.from("favorites").select("id, is_favorite, time_played").eq("user_email",l.data.session.user.email).eq("showId",u).eq("season",a).eq("episode",I)),N=await Promise.all(m);for(let u=0;u<s.length;u++){const{data:a}=N[u],I=s[u];a.length>0?(I.isFavorite=a[0].is_favorite,I.timePlayed=a[0].time_played):(I.isFavorite=!1,I.timePlayed=0)}for(const u of e.seasons)u.episodes=s.filter(a=>a.season===u.season).map(a=>({title:a.title,description:a.description,episode:a.episode,file:a.file,isFavorite:a.isFavorite,timePlayed:a.timePlayed}));return _=e,t.value=!0,{showData:_}}}catch(d){console.error(d)}})();let D=k("");const S=d=>{D.value=d};return(d,i)=>{const e=K("router-link");return f(),C(x,null,[o(U,{class:"backButton",variant:"tonal","append-icon":"mdi-arrow-u-left-bottom"},{default:n(()=>[o(e,{to:"/browse"},{default:n(()=>[w("Back to Browse")]),_:1})]),_:1}),g(t)?(f(),V(P,{key:0,class:"fill-height"},{default:n(()=>[o(te,{onSeasonSelected:S,showData:g(_)},null,8,["showData"]),o(ue,{showData:g(_),seasonFilter:g(D)},null,8,["showData","seasonFilter"]),he]),_:1})):(f(),V(P,{key:1,class:"loadingContainer"},{default:n(()=>[o(Z)]),_:1}))],64)}}},ge=q(pe,[["__scopeId","data-v-3887d759"]]);export{ge as default};
